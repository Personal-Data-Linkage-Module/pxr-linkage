# Copyright 2022 NEC Corporation
# Released under the MIT license.
# https://opensource.org/licenses/mit-license.php
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: root-ctoken-ledger-service-container-config-map
  namespace: <namespace>
data:
  config.json: |
    {
      "operator": {
        "session": "http://localhost:3000/operator/session"
      },
      "catalog": {
        "get": "http://localhost:3001/catalog",
        "getCatalogName": "http://localhost:3001/catalog/name"
      },
      "bookManage": {
        "search": "http://localhost:3005/book-manage/search?disableFlg=1"
      },
      "timezone": "Asia/Tokyo"
    }
  default.yml: |
    # SDE-IMPL-RECOMMENDED REST API サーバーのポート番号を指定します
    ports:
      http: 3008

    # SDE-IMPL-RECOMMENDED ログレベルを次のいずれかを設定します[none/debug/info]
    loglevel: info

    # SDE-MSA-PRIN 過負荷を回避する （MSA-PRIN-ID-02）
    # SDE-IMPL-RECOMMENDED Backpressureの設定をします
    backPressure:
      threshold: 10000  # 同時実行数しきい値
  log4js.config.json: |
    {
      "appenders": {
        "ConsoleLogAppender": {
          "type": "console"
        },
        "SystemLogAppender": {
          "type": "dateFile",
          "filename": "./logs/system.log",
          "pattern": ".yyyy-MM-dd",
          "daysToKeep": 30,
          "alwaysIncludePattern": false,
          "layout": {
            "type": "pattern",
            "pattern": "[%d{yyyy-MM-dd hh:mm:ss.SSS}] [%p] %m"
          }
        },
        "HttpLogAppender": {
          "type": "dateFile",
          "filename": "./logs/http.log",
          "pattern": ".yyyy-MM-dd",
          "daysToKeep": 30,
          "alwaysIncludePattern": false,
          "layout": {
            "type": "pattern",
            "pattern": "[%d{yyyy-MM-dd hh:mm:ss.SSS}] [%p] [%x{sessionId}] [%x{requestId}] %m"
          }
        },
        "AccessLogAppender": {
          "type": "dateFile",
          "filename": "./logs/access.log",
          "pattern": ".yyyy-MM-dd",
          "daysToKeep": 30,
          "alwaysIncludePattern": false,
          "layout": {
            "type": "pattern",
            "pattern": "[%d{yyyy-MM-dd hh:mm:ss.SSS}] [%p] [%x{sessionId}] [%x{requestId}] %m"
          }
        },
        "ApplicationLogAppender": {
          "type": "dateFile",
          "filename": "./logs/application.log",
          "pattern": ".yyyy-MM-dd",
          "daysToKeep": 30,
          "alwaysIncludePattern": false,
          "layout": {
            "type": "pattern",
            "pattern": "[%d{yyyy-MM-dd hh:mm:ss.SSS}] [%p] [%x{sessionId}] [%x{requestId}] %m"
          }
        }
      },
      "replaceConsole": true,
      "categories": {
        "default": {
          "appenders": [
            "ConsoleLogAppender"
          ],
          "level": "all"
        },
        "system": {
          "appenders": [
            "SystemLogAppender"
          ],
          "level": "all"
        },
        "http": {
          "appenders": [
            "HttpLogAppender"
          ],
          "level": "all"
        },
        "access": {
          "appenders": [
            "AccessLogAppender"
          ],
          "level": "all"
        },
        "application": {
          "appenders": [
            "ApplicationLogAppender"
          ],
          "level": "all"
        }
      }
    }
  message.json: |
    {
      "RESPONSE_ERROR": "サービスからのレスポンスの制御処理に失敗しました",
      "UNDEFINED_ERROR": "未定義のエラーが発生しました",
      "REQUEST_IS_EMPTY": "リクエストボディが空です",
      "NOT_AUTHORIZED": "未ログイン状態でのリクエストはエラーです",
      "FAILED_TAKE_SESSION": "セッション情報の取得に失敗しました",
      "FAILED_CONNECT_TO_OPERATOR": "オペレーターサービスとの接続に失敗しました",
      "FAILED_CONNECT_TO_DATABASE": "データベースとの接続に失敗しました",
      "FAILED_SAVE_ENTITY": "データベースへのデータ登録に失敗しました",
      "NOT_EXISTS_IDENTIFY_CODE": "指定された本人性確認コードは存在しません(コード: %s)",
      "PERMISSION_DENIED": "操作権限がありません",
      "EXPIRED": "指定された本人性確認コードは、有効期限切れです",
      "IS_VERIFIED": "指定された本人性確認コードは既に、確認済みになっています",
      "NOT_APPLIED_ACTOR": "申請されたアクターではありません",
      "NO_PXRID": "PXR-IDが存在しません",
      "SPECIFY_NOT_PXRID": "PXR-IDは指定できません",
      "NOT_EXIST_ROWHASH": "行ハッシュが存在しません",
      "NOT_EXIST_ACTOR": "アクターが存在しません",
      "NOT_TARGET_ACTOR": "取得可能アクターではありません",
      "NOT_TARGET_DATA": "対象データが存在しません",
      "NO_USERID": "利用者IDを設定してください",
      "FAILED_TAKE_IDENTIFICATION": "My-Condition-Book管理サービスから本人性確認事項の取得に失敗しました",
      "CATALOG_RESPONSE_BODY": "カタログサービスのレスポンス{%s}",
      "CATALOG_RESPONSE_STATUS": "カタログサービスのレスポンス ステータスコード(%s)",
      "CATALOG_IS_NOT_EXISTS": "指定したカタログは存在しません(コード: %s)",
      "FAILED_GET_CATALOG": "カタログサービスからのカタログ取得に失敗しました",
      "FAILED_CONNECT_TO_CATALOG": "カタログサービスへの接続に失敗しました",
      "INVALID_NAMESPACE_OF_CATALOG": "指定カタログのネームスペースは、期待するものではありません(/actor/app)",
      "CATALOG_IS_NOT_EXISTS_WITH_NS": "指定したカタログは存在しません(ネームスペース: %s)",
      "NOTICE_RESPONSE_STATUS": "通知サービスのレスポンス ステータスコード(%s)",
      "NOTIFICATION_CREATION_ERROR": "連携する通知の登録処理に失敗しました",
      "FAILED_ADD_NOTIFICATION_REQUEST": "通知サービスへの通知データの登録処理に失敗しました",
      "REQUEST_MISS_REQUIRED": "リクエスト内容に必須値が存在しません",
      "REQUEST_PARAMETER_IS_NOT_NUMBER": "数値を期待するパラメーターが数値ではありません",
      "REQUEST_PARAMETER_IS_NOT_STRING": "文字列を期待するパラメーターが文字列ではありません",
      "REQUEST_URL_TYPE_PARAMETER_IS_INVALID": "発行するURL種別のパラメーターが規定とする値ではありません(規定値: 0, 1)",
      "REQUEST_INVALID_CODE_OBJECT": "リクエストされたコードオブジェクトは、不正な形式です",
      "REQUEST_INVALID_DATE_FORMAT": "リクエストされた日付は、フォーマットエラーです",
      "REQUEST_EXPIRE_PARAMETER_IS_PAST_DATE": "有効期限には、過去の日付を指定できません",
      "REQUEST_STATUS_PARAMETER_IS_INVALID": "ステータスパラメーターが規定とする値ではありません(規定値: 1, 2)",
      "IS_NOT_VERIFIED": "指定された本人性確認コードは、確認済み(成功)ではありません",
      "CONDITION_DUPLICATE": "指定できるのは、ドキュメント、イベント、モノのいずれか1つです。",
      "BOOK_MANAGE_DATA_ACCUMU_GET_RESPONSE_STATUS": "My-Condition-Book管理サービス データ蓄積定義取得からのステータスコード: %s",
      "BOOK_MANAGE_DATA_ACCUMU_GET_RESPONSE": "My-Condition-Book管理サービス データ蓄積定義取得からのレスポンス: %s",
      "FAILED_BOOK_MANAGE_DATA_ACCUMU_GET": "MyConditionBook管理サービス データ蓄積定義取得に失敗しました",
      "FAILED_CONNECT_TO_BOOK_MANAGE_DATA_ACCUMU_GET": "MyConditionBook管理サービス データ蓄積定義取得への接続に失敗しました",
      "FAILED_MAKE_SERVICE_PROVIDER_LIST": "サービスプロバイダーのカタログコード取得に失敗しました",
      "validation": {
        "isArray": "配列ではありません",
        "isBoolean": "真偽値ではありません",
        "isBooleanString": "真偽値への変換に失敗しました",
        "isDate": "日付型ではありません",
        "isDateString": "日付型への変換に失敗しました",
        "isEmail": "Emailアドレスではありません",
        "isEmpty": "この値は空である必要があります",
        "isNumber": "数値ではありません",
        "isNumberString": "数値への変換に失敗しました",
        "isNotEmpty": "この値は空を期待しません",
        "isUuid": "UUIDではありません",
        "isString": "文字列ではありません",
        "isObject": "JSONではありません",
        "isDefined": "この値は必須値です"
      },
      "IF_WF_HAS_BEEN_SPECIFIED": "WFオブジェクトが指定されています"
    }
  openapi.json: |
    {
      "openapi": "3.0.2",
      "info": {
        "title": "CToken台帳サービス",
        "version": "1.0",
        "description": "CToken台帳の管理を行います。"
      },
      "servers": [
        {
          "url": "/ctoken-ledger/ctoken-ledger"
        }
      ],
      "paths": {
        "/": {
          "post": {
            "tags": [
              "CToken取得"
            ],
            "description": "CTokenの件数を検索します。",
            "requestBody": {
              "description": "検索条件",
              "required": true,
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "createAt": {
                        "type": "object",
                        "properties": {
                          "start": {
                            "type": "string",
                            "description": "検索対象開始時刻（YYYY-MM-DDThh:mm:ss+09:00）。この時刻は含む。"
                          },
                          "end": {
                            "type": "string",
                            "description": "検索対象終了時刻（YYYY-MM-DDThh:mm:ss+09:00）。この時刻は含まない。"
                          }
                        }
                      },
                      "offset": {
                        "type": "number",
                        "description": "検索開始データ位置。default: 0"
                      },
                      "limit": {
                        "type": "number",
                        "description": "検索件数。default: 10"
                      },
                      "document": {
                        "type": "array",
                        "description": "ドキュメントカタログコード配列（設定した場合、event, thing, identifierは設定不可）",
                        "items": [
                          "#/components/schemas/_code"
                        ]
                      },
                      "event": {
                        "type": "array",
                        "description": "モノカタログコード配列（設定した場合、document, thing, identifierは設定不可）",
                        "items": [
                          "#/components/schemas/_code"
                        ]
                      },
                      "thing": {
                        "type": "array",
                        "description": "モノカタログコード配列（設定した場合、document, event, identifierは設定不可）",
                        "items": {
                          "$ref": "#/components/schemas/_code"
                        }
                      },
                      "identifier": {
                        "type": "object",
                        "properties": {
                          "document": {
                            "type": "array",
                            "description": "ドキュメント識別子配列（設定した場合、document, event, thing, identifier.event, identifier.thingは設定不可）",
                            "items": {
                              "type": "string"
                            }
                          },
                          "event": {
                            "type": "array",
                            "description": "イベント識別子配列（設定した場合、document, event, thing, identifier.document, identifier.thingは設定不可）",
                            "items": {
                              "type": "string"
                            }
                          },
                          "thing": {
                            "type": "array",
                            "description": "モノ識別子配列（設定した場合、document, event, thing, identifier.document, identifier.eventは設定不可）",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  },
                  "examples": {
                    "ドキュメントカタログコード指定": {
                      "value": {
                        "createAt": {
                          "start": "2020-01-01T00:00:00.000+0900",
                          "end": "2021-01-01T00:00:00.000+0900"
                        },
                        "offset": 0,
                        "limit": 10,
                        "document": [
                          {
                            "_value": 9999999,
                            "_ver": 1
                          }
                        ]
                      }
                    },
                    "イベントカタログコード指定": {
                      "value": {
                        "createAt": {
                          "start": "2020-01-01T00:00:00.000+0900",
                          "end": "2021-01-01T00:00:00.000+0900"
                        },
                        "offset": 0,
                        "limit": 10,
                        "event": [
                          {
                            "_value": 9999999,
                            "_ver": 1
                          }
                        ]
                      }
                    },
                    "モノカタログコード指定": {
                      "value": {
                        "createAt": {
                          "start": "2020-01-01T00:00:00.000+0900",
                          "end": "2021-01-01T00:00:00.000+0900"
                        },
                        "offset": 0,
                        "limit": 10,
                        "thing": [
                          {
                            "_value": 9999999,
                            "_ver": 1
                          }
                        ]
                      }
                    },
                    "ドキュメント識別子指定": {
                      "value": {
                        "createAt": {
                          "start": "2020-01-01T00:00:00.000+0900",
                          "end": "2021-01-01T00:00:00.000+0900"
                        },
                        "offset": 0,
                        "limit": 10,
                        "identifier": {
                          "document": [
                            "b8a254ab-dc82-6e08-8677-edb8c9666aea"
                          ]
                        }
                      }
                    },
                    "イベント識別子指定": {
                      "value": {
                        "createAt": {
                          "start": "2020-01-01T00:00:00.000+0900",
                          "end": "2021-01-01T00:00:00.000+0900"
                        },
                        "offset": 0,
                        "limit": 10,
                        "identifier": {
                          "event": [
                            "b8a254ab-dc82-6e08-8677-edb8c9666aea"
                          ]
                        }
                      }
                    },
                    "モノ識別子指定": {
                      "value": {
                        "createAt": {
                          "start": "2020-01-01T00:00:00.000+0900",
                          "end": "2021-01-01T00:00:00.000+0900"
                        },
                        "offset": 0,
                        "limit": 10,
                        "identifier": {
                          "thing": [
                            "b8a254ab-dc82-6e08-8677-edb8c9666aea"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            },
            "responses": {
              "200": {
                "description": "成功時レスポンスコード",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "document": {
                          "type": "array",
                          "description": "ドキュメントCToken配列",
                          "items": {
                            "$ref": "#/components/schemas/ctoken"
                          }
                        },
                        "event": {
                          "type": "array",
                          "description": "イベントCToken配列",
                          "items": {
                            "$ref": "#/components/schemas/ctoken"
                          }
                        },
                        "thing": {
                          "type": "array",
                          "description": "モノCToken配列",
                          "items": {
                            "$ref": "#/components/schemas/ctoken"
                          }
                        }
                      }
                    },
                    "examples": {
                      "ドキュメントの場合": {
                        "value": {
                          "document": [
                            {
                              "actor": {
                                "_value": 1000438,
                                "_ver": 1
                              },
                              "wf": {
                                "_value": 1000481,
                                "_ver": 1
                              },
                              "createdAt": "2020-01-01T00:00:00.000+0900",
                              "_code": {
                                "_value": 1099999,
                                "_ver": 1
                              },
                              "identifer": "32dede2c-91ab-79c3-53d7-d4d042e08431"
                            }
                          ]
                        }
                      },
                      "イベントの場合": {
                        "value": {
                          "event": [
                            {
                              "actor": {
                                "_value": 1000438,
                                "_ver": 1
                              },
                              "wf": {
                                "_value": 1000481,
                                "_ver": 1
                              },
                              "createdAt": "2020-01-01T00:00:00.000+0900",
                              "_code": {
                                "_value": 1099999,
                                "_ver": 1
                              },
                              "identifer": "32dede2c-91ab-79c3-53d7-d4d042e08431"
                            }
                          ]
                        }
                      },
                      "モノの場合": {
                        "value": {
                          "thing": [
                            {
                              "actor": {
                                "_value": 1000438,
                                "_ver": 1
                              },
                              "wf": {
                                "_value": 1000481,
                                "_ver": 1
                              },
                              "createdAt": "2020-01-01T00:00:00.000+0900",
                              "_code": {
                                "_value": 1099999,
                                "_ver": 1
                              },
                              "identifer": "32dede2c-91ab-79c3-53d7-d4d042e08431"
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              },
              "400": {
                "description": "エラー時レスポンスコード",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "description": "ステータスコード"
                        },
                        "message": {
                          "type": "string",
                          "description": "メッセージ"
                        },
                        "reasons": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "property": {
                                "type": "string",
                                "description": "プロパティ名"
                              },
                              "value": {
                                "description": "入力値"
                              },
                              "message": {
                                "type": "string",
                                "description": "メッセージ"
                              }
                            }
                          }
                        }
                      },
                      "required": [
                        "status"
                      ]
                    },
                    "examples": {
                      "リクエストボディがJSON以外です": {
                        "value": {
                          "status": 400,
                          "message": "リクエストボディが、JSON形式ではありません"
                        }
                      },
                      "リクエストボディが空です": {
                        "value": {
                          "status": 400,
                          "message": "リクエストボディが空です"
                        }
                      },
                      "リクエストボディが配列です": {
                        "value": {
                          "status": 400,
                          "message": "リクエストボディが配列であることを許容しません"
                        }
                      },
                      "2つ以上のデータ種を指定しています": {
                        "value": {
                          "status": 400,
                          "message": "指定できるのは、ドキュメント、イベント、モノのいずれか1つです。"
                        }
                      },
                      "文字列指定プロパティが文字列ではありません": {
                        "value": {
                          "status": 400,
                          "reasons": [
                            {
                              "property": "<プロパティ名>",
                              "value": "<入力値>",
                              "message": "文字列ではありません"
                            }
                          ]
                        }
                      },
                      "数値指定プロパティが数値ではありません": {
                        "value": {
                          "status": 400,
                          "reasons": [
                            {
                              "property": "<プロパティ名>",
                              "value": "<入力値>",
                              "message": "数値ではありません"
                            }
                          ]
                        }
                      },
                      "日付指定プロパティが日付型ではありません": {
                        "value": {
                          "status": 400,
                          "reasons": [
                            {
                              "property": "<プロパティ名>",
                              "value": "<入力値>",
                              "message": "日付型ではありません"
                            }
                          ]
                        }
                      },
                      "配列指定プロパティが配列ではありません": {
                        "value": {
                          "status": 400,
                          "reasons": [
                            {
                              "property": "<プロパティ名>",
                              "value": "<入力値>",
                              "message": "配列ではありません"
                            }
                          ]
                        }
                      },
                      "必須プロパティが存在していません": {
                        "value": {
                          "status": 400,
                          "reasons": [
                            {
                              "property": "<プロパティ名>",
                              "value": null,
                              "message": "この値は必須値です"
                            }
                          ]
                        }
                      },
                      "個人はPxR-IDの設定ができません": {
                        "value": {
                          "status": 400,
                          "message": "PXR-IDは指定できません"
                        }
                      },
                      "オペレーターのアクターコードでカタログが取得できません": {
                        "value": {
                          "status": 400,
                          "message": "アクターが存在しません"
                        }
                      },
                      "CTokenの取得が可能なアクターではありません": {
                        "value": {
                          "status": 400,
                          "message": "取得可能アクターではありません"
                        }
                      },
                      "カタログの取得に失敗しました": {
                        "value": {
                          "status": 400,
                          "message": "カタログサービスからのカタログ取得に失敗しました"
                        }
                      },
                      "カタログサービスへの接続に失敗しました": {
                        "value": {
                          "status": 400,
                          "message": "カタログサービスへの接続に失敗しました"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "/count": {
          "post": {
            "tags": [
              "CToken件数検索"
            ],
            "description": "CTokenの件数を検索します。",
            "parameters": [
              {
                "in": "header",
                "name": "session",
                "required": false,
                "schema": {
                  "type": "string",
                  "description": "セッション情報",
                  "example": {
                    "sessionId": "a1da98a9a3f146b7418ddb5267bb241b0c603c61c8102f3e1e25f08aee375223",
                    "operatorId": 1,
                    "type": 3,
                    "loginId": "trader_member",
                    "name": "data_trader_member",
                    "auth": {
                      "member": {
                        "add": true,
                        "update": true,
                        "delete": true
                      }
                    },
                    "lastLoginAt": "2020-01-01T00:00:00.000+0900",
                    "attributes": {},
                    "block": {
                      "_value": 1000110,
                      "_ver": 1
                    },
                    "actor": {
                      "_value": 1000001,
                      "_ver": 1
                    }
                  }
                }
              }
            ],
            "requestBody": {
              "description": "検索条件",
              "required": true,
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "description": "検索条件のリクエストボディ",
                    "properties": {
                      "createAt": {
                        "type": "object",
                        "description": "CToken作成時間",
                        "properties": {
                          "start": {
                            "type": "string",
                            "description": "検索開始CToken作成時間"
                          },
                          "end": {
                            "type": "string",
                            "description": "検索終了CToken作成時間"
                          }
                        }
                      },
                      "pxrId": {
                        "type": "string",
                        "description": "PXR-ID"
                      },
                      "document": {
                        "$ref": "#/components/schemas/_codeValueOnly"
                      },
                      "event": {
                        "$ref": "#/components/schemas/_codeValueOnly"
                      },
                      "thing": {
                        "$ref": "#/components/schemas/_codeValueOnly"
                      }
                    },
                    "example": {
                      "createAt": {
                        "start": "2020-01-01T00:00:00.000+0900",
                        "end": "2020-09-01T00:00:00.000+0900"
                      },
                      "pxrId": null,
                      "document": [],
                      "event": [],
                      "thing": []
                    }
                  }
                }
              }
            },
            "responses": {
              "200": {
                "description": "取得に成功した際のレスポンスコード",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "array",
                      "description": "CToken件数結果",
                      "items": {
                        "$ref": "#/components/schemas/ctokenCount"
                      }
                    },
                    "example": [
                      {
                        "pxrId": "test.---.co.jp",
                        "ctoken": {
                          "actor": {
                            "_value": 1000004
                          },
                          "app": null,
                          "wf": {
                            "_value": 1000007
                          },
                          "event": [
                            {
                              "_code": {
                                "_value": 1000008
                              },
                              "count": 5
                            }
                          ],
                          "thing": [
                            {
                              "_code": {
                                "_value": 1000011
                              },
                              "count": 20
                            }
                          ]
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        },
        "/local": {
          "post": {
            "tags": [
              "Local-CToken差分登録"
            ],
            "description": "各Blockで登録されたCTokenを登録します",
            "parameters": [
              {
                "in": "header",
                "name": "session",
                "required": false,
                "schema": {
                  "type": "string",
                  "description": "セッション情報",
                  "example": {
                    "sessionId": "a1da98a9a3f146b7418ddb5267bb241b0c603c61c8102f3e1e25f08aee375223",
                    "operatorId": 1,
                    "type": 3,
                    "loginId": "trader_member",
                    "name": "data_trader_member",
                    "auth": {
                      "member": {
                        "add": true,
                        "update": true,
                        "delete": true
                      }
                    },
                    "lastLoginAt": "2020-01-01T00:00:00.000+0900",
                    "attributes": {},
                    "block": {
                      "_value": 1000110,
                      "_ver": 1
                    },
                    "actor": {
                      "_value": 1000001,
                      "_ver": 1
                    }
                  }
                }
              }
            ],
            "requestBody": {
              "description": "登録するCToken",
              "required": true,
              "content": {
                "application/json": {
                  "schema": {
                    "type": "array",
                    "description": "CToken追加のリクエストボディ",
                    "items": {
                      "type": "object",
                      "properties": {
                        "1_1": {
                          "type": "string",
                          "description": "利用者ID"
                        },
                        "cmatrix": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "3_1_1": {
                                "type": "string",
                                "description": "イベント識別子"
                              },
                              "3_1_2_1": {
                                "type": "number",
                                "description": "イベントカタログコード"
                              },
                              "3_1_2_2": {
                                "type": "number",
                                "description": "イベントカタログバージョン"
                              },
                              "3_2_1": {
                                "type": "string",
                                "description": "イベント開始時間"
                              },
                              "3_2_2": {
                                "type": "string",
                                "description": "イベント終了時間"
                              },
                              "3_5_1_1": {
                                "type": "number",
                                "description": "イベント登録アクターカタログバージョン"
                              },
                              "3_5_1_2": {
                                "type": "number",
                                "description": "イベント登録アクターカタログバージョン"
                              },
                              "3_5_2_1": {
                                "type": "number",
                                "description": "イベント登録ワークフローカタログバージョン"
                              },
                              "3_5_2_2": {
                                "type": "number",
                                "description": "イベント登録ワークフローカタログバージョン"
                              },
                              "3_5_5_1": {
                                "type": "number",
                                "description": "イベント登録アプリケーションカタログバージョン"
                              },
                              "3_5_5_2": {
                                "type": "number",
                                "description": "イベント登録アプリケーションカタログバージョン"
                              },
                              "4_1_1": {
                                "type": "string",
                                "description": "モノ識別子"
                              },
                              "4_1_2_1": {
                                "type": "number",
                                "description": "モノカタログコード"
                              },
                              "4_1_2_2": {
                                "type": "number",
                                "description": "モノカタログバージョン"
                              },
                              "4_4_1_1": {
                                "type": "number",
                                "description": "モノ登録アクターカタログバージョン"
                              },
                              "4_4_1_2": {
                                "type": "number",
                                "description": "モノ登録アクターカタログバージョン"
                              },
                              "4_4_2_1": {
                                "type": "number",
                                "description": "モノ登録ワークフローカタログバージョン"
                              },
                              "4_4_2_2": {
                                "type": "number",
                                "description": "モノ登録ワークフローカタログバージョン"
                              },
                              "4_4_5_1": {
                                "type": "number",
                                "description": "モノ登録アプリケーションカタログバージョン"
                              },
                              "4_4_5_2": {
                                "type": "number",
                                "description": "モノ登録アプリケーションカタログバージョン"
                              },
                              "rowHash": {
                                "type": "string",
                                "description": "行ハッシュ"
                              },
                              "rowHashCreateAt": {
                                "type": "string",
                                "description": "行ハッシュ作成時間"
                              },
                              "document": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "_1_1": {
                                      "type": "string",
                                      "description": "ドキュメント識別子"
                                    },
                                    "_1_2_1": {
                                      "type": "number",
                                      "description": "ドキュメントカタログコード"
                                    },
                                    "_1_2_2": {
                                      "type": "number",
                                      "description": "ドキュメントカタログバージョン"
                                    },
                                    "_2_1": {
                                      "type": "string",
                                      "description": "ドキュメント作成時間"
                                    },
                                    "_3_1_1": {
                                      "type": "number",
                                      "description": "ドキュメント登録アクターカタログバージョン"
                                    },
                                    "_3_1_2": {
                                      "type": "number",
                                      "description": "ドキュメント登録アクターカタログバージョン"
                                    },
                                    "_3_2_1": {
                                      "type": "number",
                                      "description": "ドキュメント登録ワークフローカタログバージョン"
                                    },
                                    "_3_2_2": {
                                      "type": "number",
                                      "description": "ドキュメント登録ワークフローカタログバージョン"
                                    },
                                    "_3_5_1": {
                                      "type": "number",
                                      "description": "ドキュメント登録アプリケーションカタログバージョン"
                                    },
                                    "_3_5_2": {
                                      "type": "number",
                                      "description": "ドキュメント登録アプリケーションカタログバージョン"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "example": {
                    "add": [
                      {
                        "1_1": "test.user.id",
                        "document": [
                          {
                            "2_n_1_1": "4b9b2192-d2fc-0818-86b7-6b17eee1380e",
                            "2_n_1_2_1": 1099999,
                            "2_n_1_2_2": 1,
                            "2_n_2_1": "2020-07-01T00:00:00.000+0900",
                            "2_n_3_1_1": 1000004,
                            "2_n_3_1_2": 1,
                            "2_n_3_2_1": 1000007,
                            "2_n_3_2_2": 1,
                            "2_n_3_5_1": null,
                            "2_n_3_5_2": null
                          }
                        ],
                        "event": {
                          "3_1_1": "18efb694-c0ac-ae38-c305-f921386d05e0",
                          "3_1_2_1": 1000008,
                          "3_1_2_2": 1,
                          "3_2_1": "2020-07-01T00:00:00.000+0900",
                          "3_2_2": "2020-07-01T00:00:00.000+0900",
                          "3_5_1_1": 1000004,
                          "3_5_1_2": 1,
                          "3_5_2_1": 1000007,
                          "3_5_2_2": 1,
                          "3_5_5_1": null,
                          "3_5_5_2": null
                        },
                        "thing": [
                          {
                            "4_1_1": "06a43271-c6fb-1eb6-dbac-9f1464a1e795",
                            "4_1_2_1": 1000011,
                            "4_1_2_2": 1,
                            "4_4_1_1": 1000004,
                            "4_4_1_2": 1,
                            "4_4_2_1": 1000007,
                            "4_4_2_2": 1,
                            "4_4_5_1": null,
                            "4_4_5_2": null,
                            "rowHash": "rowHash...",
                            "rowHashCreateAt": "2020-07-01T00:00:00.000+0900"
                          }
                        ]
                      }
                    ],
                    "update": [
                      {
                        "1_1": "test.user.id",
                        "document": [
                          {
                            "2_n_1_1": "6721ac59-e21f-ac8b-b68a-7029780aa6b2",
                            "2_n_1_2_1": 1099999,
                            "2_n_1_2_2": 1,
                            "2_n_2_1": "2020-07-01T00:00:00.000+0900",
                            "2_n_3_1_1": 1000004,
                            "2_n_3_1_2": 1,
                            "2_n_3_2_1": 1000007,
                            "2_n_3_2_2": 1,
                            "2_n_3_5_1": null,
                            "2_n_3_5_2": null
                          }
                        ],
                        "event": {
                          "3_1_1": "942d3d04-b303-dbb4-17f1-d12cc7e73c6f",
                          "3_1_2_1": 1000008,
                          "3_1_2_2": 1,
                          "3_2_1": "2020-07-01T00:00:00.000+0900",
                          "3_2_2": "2020-07-01T00:00:00.000+0900",
                          "3_5_1_1": 1000004,
                          "3_5_1_2": 1,
                          "3_5_2_1": 1000007,
                          "3_5_2_2": 1,
                          "3_5_5_1": null,
                          "3_5_5_2": null
                        },
                        "thing": [
                          {
                            "4_1_1": "ef49011a-afcb-2d86-91bc-ad242d67b612",
                            "4_1_2_1": 1000011,
                            "4_1_2_2": 1,
                            "4_4_1_1": 1000004,
                            "4_4_1_2": 1,
                            "4_4_2_1": 1000007,
                            "4_4_2_2": 1,
                            "4_4_5_1": null,
                            "4_4_5_2": null,
                            "rowHash": "rowHash...",
                            "rowHashCreateAt": "2020-07-01T00:00:00.000+0900"
                          }
                        ]
                      }
                    ],
                    "delete": [
                      {
                        "1_1": "test.user.id",
                        "document": [
                          {
                            "2_n_1_1": "0f874dc0-9c24-704d-b616-3a434264684e"
                          }
                        ],
                        "event": {
                          "3_1_1": "70d54b9b-3a18-9181-f3d6-60b8a2e83d7c"
                        },
                        "thing": [
                          {
                            "4_1_1": "ad3002f7-0b75-90b0-4914-322f3004ac51"
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            },
            "responses": {
              "200": {
                "description": "CToken登録に成功した際のレスポンスコード",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "description": "CToken登録のレスポンスボディ",
                      "properties": {
                        "result": {
                          "type": "string",
                          "description": "結果"
                        }
                      }
                    },
                    "example": {
                      "result": "success"
                    }
                  }
                }
              }
            }
          }
        },
        "/search": {
          "post": {
            "tags": [
              "PXR-ID検索"
            ],
            "description": "検索条件に一致するCTokenを持つ個人を特定します。",
            "parameters": [
              {
                "in": "header",
                "name": "session",
                "required": false,
                "schema": {
                  "type": "string",
                  "description": "セッション情報",
                  "example": {
                    "sessionId": "a1da98a9a3f146b7418ddb5267bb241b0c603c61c8102f3e1e25f08aee375223",
                    "operatorId": 1,
                    "type": 3,
                    "loginId": "trader_member",
                    "name": "data_trader_member",
                    "auth": {
                      "member": {
                        "add": true,
                        "update": true,
                        "delete": true
                      }
                    },
                    "lastLoginAt": "2020-01-01T00:00:00.000+0900",
                    "attributes": {},
                    "block": {
                      "_value": 1000110,
                      "_ver": 1
                    },
                    "actor": {
                      "_value": 1000001,
                      "_ver": 1
                    }
                  }
                }
              }
            ],
            "requestBody": {
              "description": "検索条件",
              "required": true,
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "description": "検索条件のリクエストボディ",
                    "properties": {
                      "pxrId": {
                        "type": "array",
                        "description": "検索対象PXR-ID配列",
                        "items": {
                          "type": "integer",
                          "description": "検索対象PXR-ID"
                        }
                      },
                      "condition": {
                        "type": "object",
                        "description": "検索条件",
                        "properties": {
                          "type": {
                            "type": "string",
                            "description": "検索種別"
                          },
                          "_code": {
                            "$ref": "#/components/schemas/_code"
                          },
                          "min": {
                            "type": "integer",
                            "description": "最小件数"
                          },
                          "max": {
                            "type": "integer",
                            "description": "最大件数"
                          }
                        }
                      }
                    },
                    "example": {
                      "pxrId": [
                        "pxr_test_01",
                        "pxr_test_02",
                        "pxr_test_03"
                      ],
                      "condition": [
                        {
                          "type": "and",
                          "_code": {
                            "_value": 1000011,
                            "_ver": 1
                          },
                          "min": 1,
                          "max": 100
                        }
                      ]
                    }
                  }
                }
              }
            },
            "responses": {
              "200": {
                "description": "取得に成功した際のレスポンスコード",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "array",
                      "description": "該当PXR-ID配列",
                      "items": {
                        "type": "integer",
                        "description": "該当PXR-ID"
                      }
                    },
                    "example": [
                      "pxr_test_02",
                      "pxr_test_03"
                    ]
                  }
                }
              }
            }
          }
        }
      },
      "components": {
        "schemas": {
          "ctokenCount": {
            "type": "object",
            "description": "PXR-ID毎のCToken件数",
            "properties": {
              "pxrId": {
                "type": "string",
                "description": "PXR-ID"
              },
              "ctoken": {
                "type": "array",
                "items": {
                  "properties": {
                    "actor": {
                      "$ref": "#/components/schemas/_codeValueOnly"
                    },
                    "app": {
                      "$ref": "#/components/schemas/_codeValueOnly"
                    },
                    "wf": {
                      "$ref": "#/components/schemas/_codeValueOnly"
                    },
                    "event": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/countObject"
                      }
                    },
                    "thing": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/countObject"
                      }
                    }
                  }
                }
              }
            }
          },
          "countObject": {
            "type": "object",
            "description": "イベント・モノ毎の件数",
            "properties": {
              "_code": {
                "$ref": "#/components/schemas/_codeValueOnly"
              },
              "count": {
                "type": "integer",
                "description": "件数"
              }
            }
          },
          "_code": {
            "type": "object",
            "properties": {
              "_value": {
                "type": "integer",
                "description": "カタログコード"
              },
              "_ver": {
                "type": "integer",
                "description": "カタログバージョン"
              }
            }
          },
          "_codeValueOnly": {
            "type": "object",
            "properties": {
              "_value": {
                "type": "integer",
                "description": "カタログコード"
              }
            }
          },
          "ctoken": {
            "type": "object",
            "properties": {
              "actor": {
                "$ref": "#/components/schemas/_code"
              },
              "app": {
                "$ref": "#/components/schemas/_code"
              },
              "wf": {
                "$ref": "#/components/schemas/_code"
              },
              "createdAt": {
                "type": "string",
                "description": "データ作成時刻"
              },
              "_code": {
                "$ref": "#/components/schemas/_code"
              },
              "identifer": {
                "type": "string",
                "description": "データ識別子"
              }
            }
          }
        }
      }
    }
  ormconfig.json: |
    {
      "name": "postgres",
      "type": "postgres",
      "host": "external-db-service",
      "port": 5432,
      "database": "<database_name>",
      "schema": "pxr_ctoken_ledger",
      "username": "<user_name>",
      "password": "<password>",
      "synchronize": false,
      "logging": false
    }
